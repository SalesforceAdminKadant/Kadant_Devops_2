var embed=function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},t(e,r)};var r=function(){function e(){this._listeners=[]}return e.prototype.add=function(e,t){void 0===t&&(t=null),this._listeners.push({callback:e,tag:t})},e.prototype.remove=function(e){if("function"==typeof e){for(var t=0;t<this._listeners.length;t++)if(this._listeners[t].callback===e){this._listeners.splice(t,1);break}}else this._listeners.length=0},e.prototype.removeByTag=function(e){for(var t=0;t<this._listeners.length;t++)this._listeners[t].tag===e&&this._listeners.splice(t,1)},e.prototype.trigger=function(e){for(var t=0,r=this._listeners;t<r.length;t++){r[t].callback.apply(null,[e])}},e}(),o=function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)},i=document.getElementsByTagName("script"),s=i[i.length-1].src.split("/"),n=s[0]+"//"+s[2],a=function(){function e(e){var t=this;this.args=e,this._messageQueue=[],this._loading=!0,this._callbackMap={},this._correspondenceId=1,this.onMessage=new r,this.onSubmit=new r,e.kbmaxUrl||(e.kbmaxUrl=n),e.elementId&&(e.elementSelector="#"+e.elementId),this.fillLayoutSettings();var o=this.elem=document.querySelector(e.elementSelector);if(!o)throw new Error("no element was found with the given selector of '"+e.elementSelector+"'");if("absolute"!==window.getComputedStyle(o,null).position&&(o.style.position="relative"),this._iframe=this.elem.querySelector("iframe"),this._iframe&&(this._loading=!this._iframe.hasAttribute("data-kbmax-loaded")),this._loading&&(this._messageHandler||(this._messageHandler=function(r){var o=r.data;if(o&&o.name){var i=o.name.toLowerCase();if("configuratorloaded"==i||"sceneloaded"==i)o.data.requestId==e.elementSelector&&(t._loading=!1,t._iframe.setAttributeNode(document.createAttribute("data-kbmax-loaded")),t._messageQueue.forEach((function(e){t._sendMessage(e)})),t._onLoaded&&t._onLoaded());else if("submit"==i)t.onSubmit.trigger(o);else if("readytoloadconfiguredproduct"==i)t.readyToLoadConfiguredProduct();else if("loginsso"==i)window.location.href=e.kbmaxUrl+"/ssosignin?RedirectUrl="+window.location.href;else if(o.correspondenceId){var s=t._callbackMap[parseInt(o.correspondenceId)];s&&s(o.data)}else t.onMessage.trigger(o)}},window.addEventListener("message",this._messageHandler))),!this._iframe){var i=this._getIFrameSrc();if(this._iframe=document.createElement("iframe"),this._iframe.src=i,this._iframe.setAttributeNode(document.createAttribute("allowfullscreen")),this._iframe.setAttribute("allow","xr-spatial-tracking 'self' "+this.args.kbmaxUrl+"; fullscreen *"),this._iframe.style.width="100%",this._iframe.style.height="100%",this._iframe.style.position="absolute",this._iframe.style.border="none",this.elem.insertBefore(this._iframe,this.elem.firstChild),this._logo=this.elem.querySelector("a"),this._logo){this._logo.href="https://www.kbmax.com",this._logo.target="_blank",this._logo.style.position="absolute",this._logo.style.right="20px",this._logo.style.bottom="20px",this._logo.style.width="12%",this._logo.style.textAlign="right";var s=this._logo.querySelector("img");s&&(s.src=e.kbmaxUrl+"/images/kbmax_logo_horizontal.png",s.alt="3D Configurator by KBMax",s.style.maxHeight="108px",s.style.maxWidth="160px",s.style.height="auto",s.style.width="100%")}if(e.bindToFormSelector){for(var a=document.querySelectorAll(e.bindToFormSelector+" input, "+e.bindToFormSelector+" select, "+e.bindToFormSelector+" textarea"),d=0;d<a.length;d++){var c=a[d];this.watchElementForChange(c)}if(window.MutationObserver){var l=new MutationObserver((function(e){e.forEach((function(e){if("childList"==e.type)for(var r=0;r<e.addedNodes.length;r++){var o=e.addedNodes[r];(o instanceof HTMLInputElement||o instanceof HTMLSelectElement||o instanceof HTMLTextAreaElement)&&t.watchElementForChange(o)}})),e.some((function(e){return"childList"==e.type}))&&t.setFieldsFromForm(t.args.bindToFormSelector)})),u=document.querySelectorAll(e.bindToFormSelector);for(d=0;d<u.length;d++){var h=u[d];l.observe(h,{childList:!0,subtree:!0})}}this.setFieldsFromForm(e.bindToFormSelector)}}}return e.prototype.watchElementForChange=function(e){var t=this;e.addEventListener("change",(function(){t.setFieldsFromForm(t.args.bindToFormSelector)}))},e.prototype.onLoaded=function(e){this._onLoaded=e},e.prototype._sendMessage=function(e){this._loading?this._messageQueue.push(e):this._iframe.contentWindow.postMessage(e,"*")},e.prototype.requireWebGL=function(){this.supportsWebGL()},e.prototype.readyToLoadConfiguredProduct=function(){},e.prototype.serializeFormToObject=function(e){var t={},r=document.querySelector(e);if(r)for(var o=r.querySelectorAll("input, select, textarea"),i=0;i<o.length;i++){var s=o[i],n=s.getAttribute("kbmax-name")||s.getAttribute("data-kbmax-name")||s.getAttribute("name");if(n&&!s.getAttribute("disabled"))if("checkbox"===s.getAttribute("type")){var a=s;t[n]=a.checked}else if("radio"===s.getAttribute("type")){(a=s).checked&&(t[n]=a.value)}else if("select"===s.tagName){var d=s;if(d.multiple){t[n]=[];for(var c=d.getElementsByTagName("option"),l=0;l<c.length;l++){var u=c[l];u.selected&&t[n].push(u.value)}}else t[n]=d.value}else t[n]=s.value}return t},e.prototype.supportsWebGL=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},e.prototype.setFieldsFromForm=function(e){this.setFields(this.serializeFormToObject(e))},e.prototype.render=function(){var e={name:"render",data:void 0};this._sendMessage(e)},e.prototype.snapshot=function(e,t){var r=this._correspondenceId++;this._callbackMap[r]=t,this._sendMessage({name:"snapshot",data:e,correspondenceId:r.toString()})},e.prototype.setFields=function(e,t){var r=this._correspondenceId++;this._callbackMap[r]=t;var o={name:"setFields",data:e,correspondenceId:r.toString()};this._sendMessage(o)},e.prototype.getFields=function(e){var t=this._correspondenceId++;this._callbackMap[t]=e;var r={name:"getFields",data:{},correspondenceId:t.toString()};this._sendMessage(r)},e.prototype.runAction=function(e,t){var r=this._correspondenceId++;this._callbackMap[r]=t;var o={name:"runAction",data:e,correspondenceId:r.toString()};this._sendMessage(o)},e.prototype.runSubmitRule=function(e){var t=this._correspondenceId++;this._callbackMap[t]=e;var r={name:"runsubmitrule",data:{},correspondenceId:t.toString()};this._sendMessage(r)},e.prototype.getPrice=function(e){var t=this._correspondenceId++;this._callbackMap[t]=e;var r={name:"getprice",data:{},correspondenceId:t.toString()};this._sendMessage(r)},e.prototype.fillLayoutSettings=function(){this.args.layoutSettings=this.args.layoutSettings||{},this.args.layoutSettings.hasOwnProperty("Show Pages")||(this.args.layoutSettings["Show Pages"]=this.args.showFields),this.args.layoutSettings.hasOwnProperty("Show Header")||(this.args.layoutSettings["Show Header"]=this.args.showConfigHeader)},e.prototype.dispose=function(){this._iframe&&(this._iframe.remove(),this._iframe=void 0),this._logo&&(this._logo.remove(),this._logo=void 0),this._messageQueue=[],this._loading=!1,this._onload=void 0,this._messageHandler&&window.removeEventListener("message",this._messageHandler),this._callbackMap={},this.onMessage.remove(),this.onSubmit.remove()},e}(),d=function(e){function t(t){var r=e.call(this,t)||this;return r.requireWebGL(),r}return o(t,e),t.prototype._getIFrameSrc=function(){return this.args.kbmaxUrl+"/scenes/"+this.args.sceneId.toString()+"?embedded=true&requestid="+encodeURIComponent(this.args.elementSelector)+"&showheader="+(!1!==this.args.showHeader)+"&showdrawer="+(!1!==this.args.showDrawer)+"&showmove="+(!1!==this.args.showMove)+"&idtheme="+(this.args.idTheme||"")+"&fields="+(this.args.fields?encodeURIComponent(JSON.stringify(this.args.fields)):"")+"&layoutsettings="+(this.args.layoutSettings?encodeURIComponent(JSON.stringify(this.args.layoutSettings)):"")+"&parameters="+(this.args.parameters?encodeURIComponent(JSON.stringify(this.args.parameters)):"")+"&transparentbackground="+(!0===this.args.transparentBackground)},t}(a),c=function(e){function t(t){var r=this;return t.id&&(t.configuratorId=t.id),(r=e.call(this,t)||this).configuredProduct=t.configuredProduct,r}return o(t,e),t.prototype.readyToLoadConfiguredProduct=function(){var e={name:"setconfiguredproduct",data:this.configuredProduct};this._iframe.contentWindow.postMessage(e,"*")},t.prototype._getIFrameSrc=function(){var e=this.args.kbmaxUrl;return this.args.configuredProductId?e+="/quoteproducts/"+this.args.configuredProductId:e+="/configurators/"+this.args.configuratorId.toString(),e+="?embedded=true&requestid="+encodeURIComponent(this.args.elementSelector)+"&showheader="+(!1!==this.args.showHeader)+"&showdrawer="+(!1!==this.args.showDrawer)+"&showmove="+(!1!==this.args.showMove)+"&currency="+encodeURIComponent(this.args.currency||"")+"&idtheme="+(this.args.idTheme||"")+"&fields="+(this.args.fields?encodeURIComponent(JSON.stringify(this.args.fields)):"")+"&layoutsettings="+(this.args.layoutSettings?encodeURIComponent(JSON.stringify(this.args.layoutSettings)):"")+"&parameters="+(this.args.parameters?encodeURIComponent(JSON.stringify(this.args.parameters)):""),this.args.configuredProduct&&(e+="&deferLoadedRule=true"),this.args.autoSsoLogin&&(e+="&autoSsoLogin=true"),this.args.cookieToken&&(e+="&cookieToken="+encodeURIComponent(this.args.cookieToken)),this.args.kineticCompany&&(e+="&kineticCompany="+encodeURIComponent(this.args.kineticCompany)),this.args.kineticPlant&&(e+="&kineticPlant="+encodeURIComponent(this.args.kineticPlant)),this.args.kineticCustomerId&&(e+="&kineticCustomerId="+encodeURIComponent(this.args.kineticCustomerId)),this.args.kineticCustomerNumber&&(e+="&kineticCustomerNumber="+encodeURIComponent(this.args.kineticCustomerNumber)),this.args.kineticQuoteNumber&&(e+="&kineticQuoteNumber="+encodeURIComponent(this.args.kineticQuoteNumber)),this.args.kineticQuoteLine&&(e+="&kineticQuoteLine="+encodeURIComponent(this.args.kineticQuoteLine)),this.args.kineticOrderNumber&&(e+="&kineticOrderNumber="+encodeURIComponent(this.args.kineticOrderNumber)),this.args.kineticOrderLine&&(e+="&kineticOrderLine="+encodeURIComponent(this.args.kineticOrderLine)),this.args.kineticJobNumber&&(e+="&kineticJobNumber="+encodeURIComponent(this.args.kineticJobNumber)),this.args.kineticAssemblySeq&&(e+="&kineticAssemblySeq="+encodeURIComponent(this.args.kineticAssemblySeq)),this.args.kineticCallContext&&(e+="&kineticCallContext="+encodeURIComponent(this.args.kineticCallContext)),this.args.kineticUserId&&(e+="&kineticUserId="+encodeURIComponent(this.args.kineticUserId)),e},t.prototype.setConfiguredProduct=function(e,t){var r=this._correspondenceId++;this._callbackMap[r]=t;var o={name:"setConfiguredProduct",data:e,correspondenceId:r.toString()};this._sendMessage(o)},t.prototype.getConfiguredProduct=function(e){var t=this._correspondenceId++;this._callbackMap[t]=e;var r={name:"getConfiguredProduct",data:{},correspondenceId:t.toString()};this._sendMessage(r)},t.prototype.saveProductAndSubmit=function(e){var t=this._correspondenceId++;this._callbackMap[t]=e;var r={name:"saveProductAndSubmit",data:{},correspondenceId:t.toString()};this._sendMessage(r)},t.prototype.saveProduct=function(e){var t=this._correspondenceId++;this._callbackMap[t]=e;var r={name:"saveProduct",data:{},correspondenceId:t.toString()};this._sendMessage(r)},t}(a),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(d),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(c),h=function(){for(var e=document.querySelectorAll("[data-kbmax]"),t=0;t<e.length;t++){var r=e[t];if(r.id||(r.id="viewer"),!r.hasAttribute("data-scene-id")&&!r.hasAttribute("data-configurator-id"))throw new Error("kbmax element must have the data-scene-id or data-configurator-id attribute");var o=Number(r.getAttribute("data-scene-id")),i=r.getAttribute("data-scene-guid"),s=Number(r.getAttribute("data-configurator-id")),n="true"===r.getAttribute("data-transparent-background"),a=!("false"===r.getAttribute("data-show-fields")),l=!("false"===r.getAttribute("data-show-header")),u=!("false"===r.getAttribute("data-show-config-header")),h="true"===r.getAttribute("data-show-drawer"),g=!("false"===r.getAttribute("data-show-move")),m=r.getAttribute("data-bind-to-form"),p=r.getAttribute("data-currency"),f=r.getAttribute("data-id-theme"),b=r.getAttribute("data-fields"),_=r.getAttribute("data-layout-settings"),y=r.getAttribute("data-parameters");if(s)new c({elementSelector:"#"+r.id,configuratorId:s,showFields:a,showHeader:l,showConfigHeader:u,showDrawer:h,showMove:g,bindToFormSelector:m,currency:p,idTheme:f&&Number(f),fields:JSON.parse(b),layoutSettings:JSON.parse(_),parameters:JSON.parse(y)});else new d({elementSelector:"#"+r.id,sceneId:o,sceneGuid:i,transparentBackground:n,showFields:a,showHeader:l,showConfigHeader:u,showDrawer:h,showMove:g,bindToFormSelector:m,idTheme:f&&Number(f),fields:JSON.parse(b),layoutSettings:JSON.parse(_),parameters:JSON.parse(y)})}};return h(),document.addEventListener("DOMContentLoaded",(function(){h()})),e.ConfiguratorEmbed=c,e.Embed=a,e.KBMaxConfigurator=u,e.SceneEmbed=d,e.Viewer3D=l,e.__extends=o,e}({}),kbmax=embed;console.log("KB Max Viewer Loaded!");
//# sourceMappingURL=embed.min.js.map
